{% load i18n %}
{% load static %}
{% load report_extra %}
{% load ooi_extra %}

<section>
    <div>
        {% if selected_oois and selected_report_types %}
            <h2>{% translate "Report name" %}</h2>
            <p>
                {% blocktranslate trimmed %}
                    Give your report a name. Currently, it is only possible to
                    give a name to the parent report. Subreports cannot be given a name.
                {% endblocktranslate %}
            </p>
            <div class="modal-wrapper">
                <table>
                    <caption class="visually-hidden">{% translate "Report names:" %}</caption>
                    <thead>
                        <tr>
                            <th scope="col">{% translate "Name" %}</th>
                            <th scope="col"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            {% if index_url_aggregate_report in request.path|urlencode %}
                                <td>{% translate "Aggregate Report" %}</td>
                            {% elif selected_oois|length > 1 or selected_report_types|length > 1 %}
                                <td>{% translate "Concatenated Report" %}</td>
                            {% else %}
                                <td>{{ selected_report_types.0|get_report_type_name }} for {{ selected_oois.0|human_readable }}</td>
                            {% endif %}
                            <td>
                                <button class="icon ti-edit action-button modal-trigger" data-target={{ dialogid }}>Edit {{ dialogid }}
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <dialog class="modal {{ size }}"
                        aria-modal="true"
                        role="dialog"
                        id="{{ dialogid }}">
                    <div class="content-wrapper">
                        <section class="header">
                            <h2>{% translate "Change report name" %}</h2>
                            <button class="icon-only ti-x close-modal-button"
                                    aria-label="{% translate "Close modal" %}"></button>
                        </section>
                        <form id="generate_report" class="inline" method="post" action="{{ next }}">
                            <section class="content">
                                {% csrf_token %}
                                {% url "aggregate_report_landing" organization.code as index_url_aggregate_report %}
                                <p>
                                    {% blocktranslate %}
                                        Give your report a custom name and optionally add the reports' reference date
                                        to the name. To do so you can select a standard option or use a Python
                                        strftime code in the report name.
                                    {% endblocktranslate %}
                                </p>
                                <p>
                                    <label for="report-name">{% translate "Report name" %}</label>
                                    {% if index_url_aggregate_report in request.path|urlencode %}
                                        <input id="report-name"
                                               name="report-name"
                                               type="text"
                                               autocomplete="on"
                                               value="Aggregate Report">
                                    {% elif selected_oois|length > 1 or selected_report_types|length > 1 %}
                                        <input id="report-name"
                                               name="report-name"
                                               type="text"
                                               autocomplete="on"
                                               value="Concatenated Report">
                                    {% else %}
                                        <input id="report-name"
                                               name="report-name"
                                               type="text"
                                               autocomplete="on"
                                               value="{{ selected_report_types.0|get_report_type_name }} for {{ selected_oois.0|human_readable }}">
                                    {% endif %}
                                    <div>
                                        <label for="reference-date">{% translate "Add reference date" %}</label>
                                        <select id="reference-date" name="reference-date" required>
                                            <option disabled selected value="">-- {% translate "Select option" %} --</option>
                                            <option value="">{% translate "No reference date" %}</option>
                                            <option value="{{ reference_date|date:"N jS Y, H:i" }}">
                                                {% translate "Day" %} ({{ reference_date|date:"N jS Y, H:i" }})
                                            </option>
                                            <option value="{% translate "Week" %} {{ reference_date|date:"W, Y" }}">
                                                {% translate "Week" %} ({% translate "Week" %} {{ reference_date|date:"W, Y" }})
                                            </option>
                                            <option value="{{ reference_date|date:"N, Y" }}">{% translate "Month" %} ({{ reference_date|date:"N, Y" }})</option>
                                            <option value="{{ reference_date|date:"Y" }}">{% translate "Year" %} ({{ reference_date|date:"Y" }})</option>
                                        </select>
                                    </div>
                                </p>
                            </section>
                            <section class="footer">
                                <div class="toolbar">
                                    <button type="submit">
                                        {% translate "Generate report" %}<span class="icon ti-chevron-right"></span>
                                    </button>
                                </div>
                            </section>
                        </form>
                    </div>
                </dialog>
            </div>
        {% else %}
            <a class="button ghost" href="{{ previous }}">
                <span class="icon ti-chevron-left"></span>{% translate "Go back" %}
            </a>
        {% endif %}
    </div>
</section>
