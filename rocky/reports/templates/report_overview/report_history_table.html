{% load i18n %}
{% load ooi_extra %}

<section>
    <div>
        <h2>{% translate "Report history" %}</h2>
        <p>
            {% blocktranslate trimmed %}
                An overview of all your generated reports.
            {% endblocktranslate %}
        </p>
        <form method="get"
              action="{{ next }}"
              class="inline layout-wide checkboxes_required">
            {% include "report_overview/report_history_form.html" %}

            <p class="de-emphasized">
                {% blocktranslate with length=reports|length total=total_oois %}Showing {{ length }} of {{ total }} objects{% endblocktranslate %}
            </p>
            <table>
                <caption class="visually-hidden">{% translate "Reports:" %}</caption>
                <thead>
                    <tr>
                        <th scope="col">{% translate "ID" %}</th>
                        <th scope="col">{% translate "Name" %}</th>
                        <th scope="col">{% translate "Report type" %}</th>
                        <th scope="col">{% translate "Objects" %}</th>
                        <th scope="col">{% translate "Reference date" %}</th>
                        <th scope="col">{% translate "Creation date" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for report in reports %}
                        <tr>
                            <td>
                                <a href="{% url "view_report" organization.code %}?report_id={{ report.0.reference }}&observed_at={{ report.observed_at|date:"Y-m-d" }}"
                                   title="{% translate "Shows report detail" %}">{{ report.0.reference }}</a>
                            </td>
                            <td>{{ report.0.name }}</td>
                            <td>{{ report.0.report_type }}</td>
                            <td>{{ report.0.input_ooi }}</td>
                            <td>{{ report.0.observed_at }}</td>
                            <td>{{ report.0.date_generated }}</td>
                        </tr>
                        {% if report.1 %}
                            <tr class="expando-row">
                                <td colspan="7">
                                    <ul class="accordion break-title">
                                        {% for child in report.1 %}
                                            <li>
                                                <button type="button" aria-expanded="false">{{ child.report_type }} of {{ child.input_ooi|human_readable }}</button>
                                                <div aria-labelledby="child-report-details">
                                                    <h5>{% translate "Report type" %}</h5>
                                                    <p>{{ child.report_type }}</p>
                                                    <h5>{% translate "Object" %}</h5>
                                                    <p>{{ child.input_ooi|human_readable }}</p>
                                                    <h5>{% translate "Reference date" %}</h5>
                                                    <p>{{ child.observed_at }}</p>
                                                    <h5>{% translate "Creation date" %}</h5>
                                                    <p>{{ child.date_generated }}</p>
                                                </div>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </form>
        {% include "partials/list_paginator.html" %}

    </div>
</section>
